import{defineInterface as e}from"@directus/extensions-sdk";import{defineComponent as t,ref as a,watch as n,resolveComponent as l,openBlock as i,createElementBlock as o,Fragment as u,renderList as s,createElementVNode as r,toDisplayString as d,createBlock as p,resolveDynamicComponent as v,mergeProps as c,createCommentVNode as y,createVNode as f,withCtx as m,createTextVNode as k}from"vue";import{useI18n as h}from"vue-i18n";var g=t({props:{value:{type:null,default:null},schema:{type:null,default:null},allowOther:{type:Boolean,default:!1},asList:{type:Boolean,default:!1}},emits:["input"],setup(e,{emit:t}){const{t:l}=h(),i=a(Object.keys(e.value||{}).filter((t=>{var a;return!(null===(a=e.schema)||void 0===a?void 0:a.find((e=>e.key===t)))})).map((t=>{var a;const n=null===(a=e.value)||void 0===a?void 0:a[t];return{key:t,value:n,type:o(n)}})));return n(i,(()=>{var a;if(e.asList)t("input",i.value.map((e=>e.value)));else{const n=null===(a=e.schema)||void 0===a?void 0:a.reduce(((t,a)=>{var n;return t[a.key]=null===(n=e.value)||void 0===n?void 0:n[a.key],t}),{}),l=i.value.reduce(((e,t)=>(e[t.key]=t.value,e)),{});t("input",{...n,...l})}}),{deep:!0}),{t:l,typeToInterface:{string:"input",integer:"input",float:"input",boolean:"boolean",list:"key-value",json:"key-value",unknown:"input"},typeToOptions:{string:{},integer:{},float:{},boolean:{},list:{asList:!0},json:{allowOther:!0},unknown:{}},otherFields:i,keyToLabel:function(e){return e.replace(/([A-Z])/g," $1").replace(/_/g," ")},updateValue:function(a,n){if(!a)return;const l={...e.value};l[a]=n,t("input",l)},addNewField:function(){i.value.push({key:e.asList?i.value.length:"",value:null,type:"unknown"})},deleteField:function(t){e.asList?i.value=i.value.filter((e=>e.key!==t)).map(((e,t)=>({...e,key:t}))):i.value=i.value.filter((e=>e.key!==t))}};function o(e){return"string"==typeof e?"string":"number"==typeof e?Number.isInteger(e)?"integer":"float":"boolean"==typeof e?"boolean":Array.isArray(e)?"list":"object"==typeof e&&null!==e?"json":"unknown"}}});const b={class:"key-value-item--key"},x={class:"key-value-item--value"},w={key:0,class:"key-value-item--space"},$={class:"key-value-item"},_={class:"key-value-item--value"};var O=[],j=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var o=O.indexOf(i);-1===o&&(o=O.push(i)-1,j[o]={}),a=j[o]&&j[o][n]?j[o][n]:j[o][n]=u()}else a=u();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function u(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var o="prepend"===n?"afterbegin":"beforeend";return i.insertAdjacentElement(o,e),e}}("\n.key-value-item[data-v-64969d30] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 20px;\n\tmargin-bottom: 20px;\n}\n.key-value-item--key[data-v-64969d30] {\n\ttext-transform: capitalize;\n\tflex: 0 0 150px;\n}\n.key-value-item--value[data-v-64969d30] {\n\tflex: 1 0 0;\n}\n.key-value-item--space[data-v-64969d30] {\n\tflex: 0 0 44px;\n}\n",{}),g.render=function(e,t,a,n,h,g){const O=l("v-input"),j=l("v-select"),L=l("v-icon"),T=l("v-button");return i(),o("div",null,[(i(!0),o(u,null,s(e.schema,(t=>(i(),o("div",{key:t.key,class:"key-value-item"},[r("div",b,d(e.keyToLabel(t.key)),1),r("div",x,[(i(),p(v(t.interface?`interface-${t.interface}`:"interface-input"),c(t.options||{},{value:e.value?.[t.key],type:t.type,onInput:a=>e.updateValue(t.key,a)}),null,16,["value","type","onInput"]))]),e.allowOther?(i(),o("div",w)):y("v-if",!0)])))),128)),e.allowOther||e.asList?(i(),o(u,{key:0},[(i(!0),o(u,null,s(e.otherFields,(t=>(i(),o("div",$,[e.asList?y("v-if",!0):(i(),p(O,{key:0,class:"key-value-item--key",modelValue:t.key,"onUpdate:modelValue":e=>t.key=e},null,8,["modelValue","onUpdate:modelValue"])),r("div",_,["unknown"===t.type?(i(),p(j,{key:0,modelValue:t.type,"onUpdate:modelValue":e=>t.type=e,items:Object.keys(e.typeToInterface)},null,8,["modelValue","onUpdate:modelValue","items"])):(i(),p(v(`interface-${e.typeToInterface[t.type]}`),c({key:1},e.typeToOptions[t.type],{value:t.value,type:t.type,onInput:e=>t.value=e}),null,16,["value","type","onInput"]))]),f(T,{rounded:"",icon:"",secondary:"",onClick:a=>e.deleteField(t.key)},{default:m((()=>[f(L,{name:"delete",outline:""})])),_:2},1032,["onClick"])])))),256)),f(T,{onClick:e.addNewField},{default:m((()=>[k(d(e.t("add_new")),1)])),_:1},8,["onClick"])],64)):y("v-if",!0)])},g.__scopeId="data-v-64969d30",g.__file="src/interface.vue";var L=e({id:"key-value",name:"Key-value",icon:"data_object",description:"Edit JSON value in a key-value format",component:g,types:["json"],group:"other",options:[{field:"schema",type:"json",name:"Schema",meta:{width:"full",interface:"list",options:{template:"{{ key }} - {{ type }}",fields:[{name:"Key",field:"key",type:"string",meta:{interface:"input",width:"half"}},{name:"$t:type",field:"type",type:"string",meta:{interface:"select-dropdown",width:"half",options:{choices:[{text:"$t:string",value:"string"},{text:"$t:text",value:"text"},{divider:!0},{text:"$t:boolean",value:"boolean"},{divider:!0},{text:"$t:integer",value:"integer"},{text:"$t:float",value:"float"},{text:"$t:decimal",value:"decimal"},{divider:!0},{text:"$t:timestamp",value:"timestamp"},{text:"$t:datetime",value:"dateTime"},{text:"$t:date",value:"date"},{text:"$t:time",value:"time"},{divider:!0},{text:"$t:json",value:"json"},{text:"$t:csv",value:"csv"},{text:"$t:uuid",value:"uuid"},{text:"$t:hash",value:"hash"}]}},schema:{default_value:"string"}},{name:"$t:interface_label",field:"interface",type:"string",meta:{interface:"system-interface",width:"half",options:{typeField:"type"}},schema:null},{name:"$t:note",field:"note",type:"string",meta:{interface:"system-input-translated-string",width:"full",options:{placeholder:"$t:interfaces.list.field_note_placeholder"}},schema:null},{name:"$t:options",field:"options",type:"string",meta:{interface:"system-interface-options",width:"full",options:{interfaceField:"interface"}}}]}}},{field:"allowOther",name:"Allow Other",type:"boolean",meta:{width:"half",interface:"boolean",options:{label:"Allow Other Keys"}},schema:{default_value:!1}},{field:"asList",name:"As List",type:"boolean",meta:{width:"half",interface:"boolean",options:{label:"Render as List"}},schema:{default_value:!1}}]});export{L as default};
